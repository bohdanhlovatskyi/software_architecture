version: '0'

services:
  facade:
    build: ./facade
    ports:
      - "8000:8000"
    env_file:
      - ./facade/.env
    depends_on:
      - message
      - logging-node-1
      - logging-node-2
      # - logging-node-3

  message:
    build: ./message
    ports:
      - "8001:8000"
    env_file:
      - ./message/.env

  # TODO: better way to do this would be leaving only one node in here
  # and running it via docker-compose --scale
  # but this would complicate the task of the lab much (print instance id)
  # (at least - up to my knownledge, which is very limited)
  logging-node-1:
    build: ./logging
    ports:
      - "8002:8000"
    env_file:
      - ./logging/.env
    depends_on:
      - logging-db-node-1
      - logging-db-node-2
      # - logging-db-node-3
    tty: true

  logging-node-2:
    build: ./logging
    ports:
      - "8003:8000"
    env_file:
      - ./logging/.env
    depends_on:
      - logging-db-node-1
      - logging-db-node-2
      # - logging-db-node-3
    tty: true

  # logging-node-3:
  #   build: ./logging
  #   ports:
  #     - "8004:8000"
  #   env_file:
  #     - ./logging/.env
  #   networks:
  #     - logging-network
  #   depends_on:
  #     - logging-db-node-1
  #     - logging-db-node-2
  #     - logging-db-node-3

  logging-db-node-1:
    image: hazelcast/hazelcast:5.2.1
    container_name: logging-db-node-1
    ports:
    - "5701:5701"
    environment:
    - HZ_CLUSTERNAME=hz_cls

  logging-db-node-2:
    image: hazelcast/hazelcast:5.2.1
    container_name: logging-db-node-2
    ports:
    - "5702:5701"
    environment:
    - HZ_CLUSTERNAME=hz_cls
  
  # logging-db-node-3:
  #   image: hazelcast/hazelcast:5.2.1
  #   container_name: logging-db-node-3
  #   ports:
  #   - "5703:5701"
  #   environment:
  #   - HZ_CLUSTERNAME=hz_cls

  logging-management-center:
    image: hazelcast/management-center:5.2.1
    container_name: logging-management-center
    ports:
    - "9000:8080"
    environment:
    - HZ_CLUSTERNAME=hz_cls
